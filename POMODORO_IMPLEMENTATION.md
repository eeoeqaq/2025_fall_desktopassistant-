# 番茄钟专注系统 - 实现说明

## 实现概述

本次实现为桌面助手添加了完整的番茄钟专注系统，包含所有需求文档中指定的功能。

## 已实现的文件

### 1. `/include/pomodoro.h` (2,487 字节)
包含以下内容：
- `PomodoroRecord` 结构体：存储单个番茄钟记录
- `Achievement` 结构体：存储成就信息
- `PomodoroManager` 类：核心管理类，包含所有功能的方法声明
- 使用 `#ifdef _WIN32` 条件编译处理 Windows 特定头文件（conio.h, windows.h）

### 2. `/src/pomodoro/pomodoro_manager.cpp` (22,405 字节)
完整实现了所有功能：

#### 数据管理功能
- `saveToFile()` - 保存番茄钟记录到文件
- `loadFromFile()` - 从文件加载番茄钟记录
- `saveAchievements()` - 保存成就状态
- `loadAchievements()` - 加载成就状态

#### 核心功能
- `startPomodoro()` - 启动番茄钟，支持：
  - 任务名称输入
  - 实时倒计时显示
  - 进度条显示
  - 暂停/继续功能（'p' 键）
  - 干扰记录功能（'i' 键）
  - 中途放弃功能（'q' 键）
  - 完成后音效提示
  - 自动进入休息模式
  
- `viewStatistics()` - 查看统计数据：
  - 总体统计（总番茄钟数、总时长、总干扰次数）
  - 今日统计
  - 7天趋势图（ASCII字符图表）
  - 平均干扰次数
  
- `viewAchievements()` - 查看成就系统：
  - 7个成就等级（1个、5个、10个、25个、50个、100个、200个）
  - 显示解锁进度
  - 自动检测并解锁新成就
  
- `viewHistory()` - 查看历史记录：
  - 显示最近20条记录
  - 倒序排列（最新在前）
  - 显示任务名、时长、干扰次数、完成状态
  
- `settings()` - 设置功能：
  - 专注时长（1-60分钟，默认25）
  - 短休息时长（1-30分钟，默认5）
  - 长休息时长（1-60分钟，默认15）
  - 长休息前番茄钟数（2-10个，默认4）
  
- `exportReport()` - 导出报告：
  - 导出为文本文件
  - 文件名包含日期
  - 包含总体统计和最近50条记录

#### 辅助功能
- `displayProgressBar()` - 显示ASCII进度条
- `formatTime()` - 格式化时间显示（MM:SS）
- `getCurrentDate()` - 获取当前日期（YYYY-MM-DD）
- `getCurrentTime()` - 获取当前时间（HH:MM:SS）
- `playSound()` - 播放音效（Windows Beep API）
- `getTodayPomodoroCount()` - 获取今日番茄钟数
- `getTotalPomodoroCount()` - 获取总番茄钟数
- `display7DaysTrend()` - 显示7天趋势图
- `checkAndUnlockAchievements()` - 检查并解锁成就

### 3. `/src/main.cpp` (修改)
修改内容：
- 添加 `#include "pomodoro.h"`
- 创建 `PomodoroManager pomodoroManager;` 实例
- 添加菜单选项 "6. 🍅 番茄钟专注系统"
- 添加 `case 6: pomodoroManager.start();` 处理
- 修改 `safeCin` 范围从 0-3 改为 0-6

### 4. `/.gitignore` (新增)
添加了适当的忽略规则：
- build/ 目录（构建产物）
- 数据文件（pomodoro_data.txt, achievements_data.txt 等）
- IDE 和操作系统文件

## 技术实现细节

### 数据持久化
- **pomodoro_data.txt**: 使用管道符(|)分隔的格式存储记录
  - 格式: `id|taskName|startTime|endTime|duration|interruptions|completed|date`
- **achievements_data.txt**: 使用管道符分隔存储成就状态
  - 格式: `name|description|requiredCount|unlocked`

### 计时实现
- 使用 `chrono::steady_clock` 进行精确计时
- 支持暂停功能，记录暂停时长并从总时长中扣除
- 使用 `this_thread::sleep_for()` 控制刷新频率（100ms）

### 键盘输入（Windows）
- 使用 `_kbhit()` 非阻塞检测按键
- 使用 `_getch()` 获取按键字符
- 支持的快捷键：
  - 'p' / 'P' - 暂停/继续
  - 'i' / 'I' - 记录干扰
  - 'q' / 'Q' - 放弃番茄钟

### 音效实现（Windows）
- 使用 Windows API `Beep(frequency, duration)`
- 完成番茄钟：三音递增（800Hz → 1000Hz → 1200Hz）
- 解锁成就：三音递增（800Hz → 1000Hz → 1200Hz）

### 跨平台兼容性
- 所有 Windows 特定功能都使用 `#ifdef _WIN32` 条件编译
- 在非 Windows 平台上：
  - 使用 `system("clear")` 代替 `system("cls")`
  - 跳过键盘输入和音效功能

## UI 设计

### 主菜单
```
════════════════════════════════════════
       🍅 番茄钟专注系统
════════════════════════════════════════

📊 快速概览:
  今日: X 个 | 总计: X 个

────────────────────────────────────────
  1. 🍅 开始番茄钟
  2. 📊 查看统计
  3. 🏆 查看成就
  4. 📜 历史记录
  5. ⚙️ 设置
  6. 📄 导出报告
  0. 🚪 返回主菜单
────────────────────────────────────────
```

### 专注模式界面
- 显示任务名称和专注时长
- 实时倒计时和进度条
- 快捷键提示
- 暂停状态显示

### 完成界面
- 显示任务信息和统计
- 播放音效
- 显示解锁的新成就（如有）
- 进入休息模式

## 集成说明

番茄钟系统已完全集成到主程序中：
1. 从主菜单选择 "6. 🍅 番茄钟专注系统"
2. 进入番茄钟子系统，拥有独立的菜单
3. 数据独立存储，不影响其他模块
4. 返回主菜单继续使用其他功能

## 测试建议（Windows 环境）

由于此代码为 Windows 特定应用，建议在 Windows 环境中进行以下测试：

1. **基本功能测试**
   - 启动番茄钟并完成完整的25分钟周期
   - 测试暂停/继续功能
   - 测试干扰记录功能
   - 测试中途放弃功能

2. **数据持久化测试**
   - 完成几个番茄钟
   - 退出并重新启动程序
   - 验证数据是否正确加载

3. **成就系统测试**
   - 完成1个、5个、10个番茄钟
   - 验证成就是否正确解锁
   - 验证音效和动画提示

4. **统计功能测试**
   - 查看统计页面
   - 验证7天趋势图显示
   - 验证数据准确性

5. **设置功能测试**
   - 修改各项时长设置
   - 验证新设置在下次番茄钟中生效

6. **报告导出测试**
   - 导出报告
   - 打开生成的txt文件验证内容

## 兼容性说明

- **Windows**: 完整功能支持
- **Linux/macOS**: 部分功能支持
  - 核心逻辑和数据管理正常工作
  - 键盘快捷键和音效不可用
  - 建议在 Windows 环境中使用以获得最佳体验

## 代码质量

- 使用现代 C++17 特性
- 遵循现有代码风格
- 适当的错误处理
- 清晰的函数命名和注释
- 模块化设计，易于维护和扩展

## 未来扩展建议

根据需求文档中的"未来扩展方向"，可以考虑：
1. 添加白噪音或背景音乐支持
2. 与 TodoList 模块集成
3. 添加每日/每周目标设置
4. 支持导出为 CSV/JSON 格式
5. 添加更丰富的统计图表
