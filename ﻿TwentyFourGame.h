#pragma once
#include <iostream>
#include <string>
#include <vector>
#include <random>
#include <algorithm>
#include <cmath>
#include <stack>
#include <sstream>
#include <iomanip>
#include <ctime>
#include <cctype>
#include <map>
#include <set>

using namespace std;

class GameInner//游戏内部类
{
public:
	int getRandomNumber(int min, int max);
	bool isValidExpression(const string& expr);
	vector<int> extractNumbersFromExpression(const string& expr);
	string formatExpression(const string& expr);
    string removeSpaces(const string& str);
        
	


};

// 游戏类
class TwentyFourGame {
private:

    struct Problem {
        vector<int> numbers;           // 四个数字
        vector<string> solutions;      // 可能的解决方案
        string example;                // 示例解决方案（用于展示）
    };
	GameInner gameInner; //游戏内部类对象
    vector<Problem> questionBank;  // 题库
    Problem currentProblem;        // 当前题目
    int totalAttempts;             // 总尝试次数
    int correctAttempts;           // 正确次数

public:
    
    // 初始化题库
    void initializeQuestionBank() {
        // 大约30个不同的24点题目，每个题目有至少一种解法
        questionBank = {
            // 经典题目
            {{1, 2, 3, 4}, {"(1+2+3)*4", "(1+3)*(2+4)", "1*2*3*4"}, "(1+2+3)*4"},
            {{1, 1, 5, 5}, {"(5-1)*(5+1)", "(5*5)-1/1", "(5-1/1)*5"}, "(5-1)*(5+1)"},
            {{1, 3, 4, 6}, {"6/(1-3/4)", "3*4*(1+6/6)"}, "6/(1-3/4)"},
            {{2, 2, 2, 9}, {"(2+9)*2+2", "2*9+2+2", "(9+2/2)*2"}, "(2+9)*2+2"},
            {{3, 3, 7, 7}, {"(3+3/7)*7", "7*(3/7+3)"}, "(3+3/7)*7"},
            {{4, 4, 7, 7}, {"(4-4/7)*7", "7*4-4"}, "(4-4/7)*7"},
            {{5, 5, 5, 1}, {"5*(5-1/5)", "(5-1/5)*5"}, "5*(5-1/5)"},
            {{6, 6, 6, 6}, {"6+6+6+6", "(6*6)-(6+6)", "(6-6/6)*6"}, "6+6+6+6"},
            {{8, 8, 8, 8}, {"8*8/(8+8)", "(8+8)-(8/8)", "(8*8)/(8+8)"}, "8*8/(8+8)"},

            // 中等难度题目
            {{2, 3, 4, 5}, {"(3+4+5)*2", "(5+3-2)*4", "(2*5-3)*4"}, "(3+4+5)*2"},
            {{2, 4, 5, 6}, {"(5-2)*4+6", "6*5/(4-2)", "(2+4)*5-6"}, "(5-2)*4+6"},
            {{2, 6, 6, 7}, {"(6*7-6)/2", "(7-2)*6-6", "6*(7-2)-6"}, "(6*7-6)/2"},
            {{3, 4, 5, 6}, {"(5-3)*4*6", "(3*4)*(6-5)", "(5+3-4)*6"}, "(5-3)*4*6"},
            {{3, 5, 6, 7}, {"(6-5+7)*3", "3*6+7-5", "(7+5)*6/3"}, "(6-5+7)*3"},
            {{4, 5, 6, 7}, {"(7-6)*4*6", "(5+7)*(6-4)", "4*6/(7-5)"}, "(7-6)*4*6"},
            {{4, 6, 8, 8}, {"(8-6)*8+4", "(4*8)-8-6", "8*6/(8-4)"}, "(8-6)*8+4"},
            {{5, 6, 7, 8}, {"(8-7+5)*6", "(5+7-8)*6", "6*8/(7-5)"}, "(8-7+5)*6"},

            // 挑战题目
            {{1, 4, 5, 6}, {"4/(1-5/6)", "6/(5/4-1)", "5*6-4-1"}, "4/(1-5/6)"},
            {{2, 5, 7, 8}, {"(2*5-7)*8", "(8-5+7)*2", "(7*8)/2-5"}, "(2*5-7)*8"},
            {{3, 3, 8, 8}, {"8/(3-8/3)", "(8*3)/(8-3)", "(3+8)*3-8"}, "8/(3-8/3)"},
            {{4, 7, 8, 9}, {"(9-7)*8+4", "(7+9)*8/4", "4*9-7-8"}, "(9-7)*8+4"},
            {{5, 8, 9, 13}, {"(13-9)*5+8", "(8-5)*(13-9)", "(9+13)*8/5"}, "(13-9)*5+8"},
            {{6, 7, 9, 10}, {"(9-7)*10+6", "10*7/6+9", "(10-7)*9-6"}, "(9-7)*10+6"},
            {{7, 8, 10, 11}, {"(10-8)*11+7", "11*8/(10-7)", "(11-7)*10-8"}, "(10-8)*11+7"},
            {{9, 10, 11, 12}, {"(12-10)*11+9", "12*10/(11-9)", "(11-9)*12-10"}, "(12-10)*11+9"},
            {{10, 10, 13, 13}, {"(13*13-10)/10", "(13-10/10)*13"}, "(13*13-10)/10"},

            // 更多题目
            {{1, 6, 8, 12}, {"12*8/(6-1)", "(12-8)*6*1", "8*6/(12/1-8)"}, "12*8/(6-1)"},
            {{2, 7, 9, 11}, {"(11-7)*9-2", "(9-2)*7-11", "11*2+9-7"}, "(11-7)*9-2"},
            {{3, 6, 9, 12}, {"(12-9)*6+3", "12*9/6+3", "(9-3)*6-12"}, "(12-9)*6+3"},
            {{4, 8, 11, 13}, {"(13-11)*8+4", "(11-4)*8-13", "13*4-11-8"}, "(13-11)*8+4"},
            {{5, 9, 12, 13}, {"(13-9)*5+12", "(12-5)*9-13", "13*12/9+5"}, "(13-9)*5+12"}
        };
    }

    TwentyFourGame() : totalAttempts(0), correctAttempts(0) {
        initializeQuestionBank();
        srand(time(0));
    }

	bool checkNumbersMatch(const vector<int>& exprNumbers);
    class ExpressionEvaluator;
	bool isExpressionValid(const string& expr);
    void showNumberDrawingAnimation();
    void showRules();
    void showHint();
    void selectNewProblem();
    void showStatistics();
	void run();

};


